/*! Baoshuo's OI Blog | Build: 69b218b | Baoshuo ( https://baoshuo.ren ) */
/* scripts/encrypt.js */
!function(b,g,c,d){var h=function(a){return b.getElementById(a)},i="oi.baoshuo.ren_key_salt",j=JSON.parse(b.getElementById("encrypt-data").innerText),k=function(a){return new Uint8Array(a.match(/[\da-f]{2}/gi).map(function(a){return parseInt(a,16)}))},l=function(a,d,b,c,e){return g.decrypt({name:"AES-CBC",iv:c},b,k(a).buffer).then(function(f){var a,b,c;return(a=d,b=e,c=f,g.verify({name:"HMAC",hash:"SHA-256"},b,k(a).buffer,c)).then(function(a){return!!a&&new TextDecoder().decode(f)})}).catch(function(a){return!1})},e=function(a,f){var e;return a.length>=32?Promise.resolve(!1):(setTimeout(function(){return window.plausible&&window.plausible("Post: Decrypt",{props:{value:location.pathname+"@"+a+"@"+(f?"auto":"manual"),path:location.pathname,password:a,auto:f}})},0),(e=a,g.importKey("raw",new TextEncoder().encode(e),{name:"PBKDF2"},!1,["deriveKey","deriveBits"])).then(function(e){var f,k,m;return Promise.all([(f=e,g.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:new TextEncoder().encode(i).buffer,iterations:1024},f,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"])),(k=e,g.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:new TextEncoder().encode(i).buffer,iterations:1024},k,{name:"AES-CBC",length:256},!0,["decrypt"])),(m=e,g.deriveBits({name:"PBKDF2",hash:"SHA-256",salt:new TextEncoder().encode("oi.baoshuo.ren_iv_salt").buffer,iterations:512},m,128)),]).then(function(a){var c,d,e,f=a[0],g=a[1],i=a[2];return(c=g,d=i,e=f,Promise.all([l(j.encryptedContent,j.contentHmacDigest,c,d,e),l(j.encryptedToc,j.tocHmacDigest,c,d,e),])).then(function(c){var d=c[0],e=c[1];if(d){var a=h("content"),f=h("encrypt-panel"),g=b.createRange().createContextualFragment(d);return a.innerHTML=null,a.appendChild(g),a.style.display=null,f.style.display="none",h("tocToggler")&&h("tocHTML")&&(h("tocToggler").style.display=null,h("tocHTML").innerHTML=e),window.codeGroup&&window.codeGroup(),!0}return!1})}).then(function(b){return b?(c.setItem("password@"+d,a),!0):(h("encrypt-message").innerHTML="\u5BC6\u7801\u9519\u8BEF\u3002",j.hint&&(h("encrypt-message").innerHTML+="<br><small>\u63D0\u793A\uFF1A"+j.hint+"</small>"),!1)})}))},a=new URL(location.href).searchParams.get("password")||c.getItem("password@"+d),f=function(){h("password-submit").addEventListener("click",function(){return e(h("password-input").value)}),h("password-input").addEventListener("keydown",function(a){"Enter"===a.key&&e(h("password-input").value)})};a?e(a,!0).then(function(a){a||f()}):f()}(document,window.crypto.subtle||window.crypto.webkitSubtle,localStorage,location.pathname)