/*! Baoshuo's OI Blog | Build: 018a489 | Baoshuo ( https://baoshuo.ren ) */
/* scripts/encrypt.js */
!function(e,n,t,r){var o=function(n){return e.getElementById(n)},a="oi.baoshuo.ren_key_salt",i=JSON.parse(o("encrypt-data").innerHTML||o("encrypt-data").textContent),c=function(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)})))},u=function(e){return n.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:(new TextEncoder).encode(a).buffer,iterations:1024},e,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"])},s=function(e){return n.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:(new TextEncoder).encode(a).buffer,iterations:1024},e,{name:"AES-CBC",length:256},!0,["decrypt"])},d=function(e){return n.deriveBits({name:"PBKDF2",hash:"SHA-256",salt:(new TextEncoder).encode("oi.baoshuo.ren_iv_salt").buffer,iterations:512},e,128)},l=function(e,t,r,o,a){return n.decrypt({name:"AES-CBC",iv:o},r,c(e).buffer).then((function(e){return(r=t,o=a,i=e,n.verify({name:"HMAC",hash:"SHA-256"},o,c(r).buffer,i)).then((function(n){return!!n&&(new TextDecoder).decode(e)}));var r,o,i})).catch((function(e){return!1}))},p=function(a,c){return a.length>=32?Promise.resolve(!1):(setTimeout((function(){return window.plausible&&window.plausible("Post: Decrypt",{props:{password:a,auto:c}})}),0),function(e){return n.importKey("raw",(new TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveKey","deriveBits"])}(a).then((function(n){return Promise.all([u(n),s(n),d(n)]).then((function(n){var t=n[0];return function(e,n,t){return Promise.all([l(i.encryptedContent,i.contentHmacDigest,e,n,t),l(i.encryptedToc,i.tocHmacDigest,e,n,t)])}(n[1],n[2],t).then((function(n){var t=n[0],r=n[1];if(t){var a=o("content"),i=o("encrypt-panel"),c=e.createRange().createContextualFragment(t);return a.innerHTML=null,a.appendChild(c),a.style.display=null,i.style.display="none",o("tocToggler")&&o("tocHTML")&&(o("tocToggler").style.display=null,o("tocHTML").innerHTML=r),window.codeGroup&&window.codeGroup(),!0}return!1}))})).then((function(e){return e?(t.setItem("password@"+r,a),!0):(o("encrypt-message").innerHTML="密码错误。",i.hint&&(o("encrypt-message").innerHTML+="<br><small>提示："+i.hint+"</small>"),!1)}))})))},f=new URL(location.href).searchParams.get("password")||t.getItem("password@"+r),h=function(){o("password-submit").addEventListener("click",(function(){return p(o("password-input").value)})),o("password-input").addEventListener("keydown",(function(e){"Enter"===e.key&&p(o("password-input").value)}))};f?p(f,!0).then((function(e){e||h()})):h()}(document,window.crypto.subtle||window.crypto.webkitSubtle,localStorage,location.pathname);